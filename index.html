<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Library Database</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const URL = "http://localhost:3000/books";
        
        function ResponseSync(method, thisurl, json) {
            let request = new XMLHttpRequest();
            request.open(method, thisurl, false);
            if (json == undefined) request.send();
            else {		
                request.setRequestHeader('Content-Type', 'application/json');
                request.send(json);
            }
            return { text:request.responseText, status:request.status };
        }
        
        function listAvailable() {
            const listAvailableLink = document.getElementById("list-available-link");
            listAvailableLink.addEventListener("click", async (event) => {
                event.preventDefault();
                try {
                    const thisurl = 'http://localhost:3000/books?avail=true';
                    const rt = ResponseSync("GET",thisurl);
                    let books = JSON.parse(rt.text);
                    bookslister(books);
                } catch (error) {
                    console.error('Error fetching books:', error);
                }
            });
        }
        
        function listCheckedout() {
            const listCheckedOutLink = document.getElementById("list-checked-out-link");
            listCheckedOutLink.addEventListener("click", async (event) => {
                event.preventDefault();
                try {
                    const thisurl = 'http://localhost:3000/books?avail=false';
                    const rt = ResponseSync("GET",thisurl);
                    let books = JSON.parse(rt.text);
                    bookslister(books);
                } catch (error) {
                    console.error('Error fetching books:', error);
                }
            });
        }
         
        function bookslister(books) {
            const htmlContent = books.map(book => {
                return `<div class="book">
                            <h2>Title: ${book.title}</h2>
                            <h2>ID: ${book.id}</h2>
                        </div>`;
            }).join("");
            updateContent(htmlContent);
        }
        
        function updateContent(content) {
            const paragraphContainer = document.querySelector(".paragraph-container");
            paragraphContainer.innerHTML = content;
        }

        function checkoutBook() {
            const checkOutLink = document.getElementById("check-out-link");
            checkOutLink.addEventListener("click", async (event) => {
                event.preventDefault();
                const bookId = prompt("Enter the ID of the book you want to check out:");
                if (bookId) {
                    try {
                        const thisurl = `http://localhost:3000/books/${bookId}`;
                        const rt = ResponseSync("PUT", thisurl, JSON.stringify({ avail: false }));
                        if (rt.status === 200) {
                            alert("Book checked out successfully!");
                            listAvailable();
                        } else {
                            alert("Failed to check out the book. Please try again.");
                        }
                    } catch (error) {
                        console.error('Error checking out book:', error);
                    }
                }
            });
        }

        function checkinBook() {
            const checkInLink = document.getElementById("check-in-link");
            checkInLink.addEventListener("click", async (event) => {
                event.preventDefault();
                const bookId = prompt("Enter the ID of the book you want to check in:");
                if (bookId) {
                    try {
                        const thisurl = `http://localhost:3000/books/${bookId}`;
                        const rt = ResponseSync("PUT", thisurl, JSON.stringify({ avail: true }));
                        if (rt.status === 200) {
                            alert("Book checked in successfully!");
                            listCheckedout();
                        } else {
                            alert("Failed to check in the book. Please try again.");
                        }
                    } catch (error) {
                        console.error('Error checking in book:', error);
                    }
                }
            });
        }
        
        function App() {
            return (
                <>
                    <header>
                        <h1>Library Database</h1>
                        <h2>Alex Kaylor (askaylor7@gmail.com)</h2>
                    </header>
    
                    <nav>
                        <ul>
                            <li><a href="#" onClick={listAvailable} id="list-available-link">List Available</a></li>
                            <li><a href="#" onClick={listCheckedout} id="list-checked-out-link">List Checked Out</a></li>
                            <li><a href="#" onClick={checkoutBook} id="check-out-link">Check Out a Book</a></li>
                            <li><a href="#" onClick={checkinBook} id="check-in-link">Check In a Book</a></li>
                        </ul>
                    </nav>
    
                    <div className="content-wrapper">
                        <div className="paragraph-container">
                        </div>
                        <div className="sidebar">
                            <h3>Book Recommendations</h3>
                            <ul>
                                <li><a href="https://www.amazon.com/dp/B0C1J9Q7Y8">James by Victoria Redel</a></li>
                                <li><a href="https://www.amazon.com/dp/B08BCG4Z7D">The Women by T.C. Boyle</a></li>
                                <li><a href="https://www.amazon.com/dp/B09V7QPQ1P">The Beast in the Clouds by Selina O'Grady</a></li>
                                <li><a href="https://www.amazon.com/dp/0307949486">The Goldfinch by Donna Tartt</a></li>
                                <li><a href="https://www.amazon.com/dp/0143039954">Middlesex by Jeffrey Eugenides</a></li>
                                <li><a href="https://www.amazon.com/dp/0385534245">The Night Circus by Erin Morgenstern</a></li>
                                <li><a href="https://www.amazon.com/dp/0307278441">A Visit from the Goon Squad by Jennifer Egan</a></li>
                                <li><a href="https://www.amazon.com/dp/0812993543">White Teeth by Zadie Smith</a></li>
                                <li><a href="https://www.amazon.com/dp/0375714837">The Brief Wondrous Life of Oscar Wao by Junot DÃ­az</a></li>
                                <li><a href="https://www.amazon.com/dp/0143039434">Everything Is Illuminated by Jonathan Safran Foer</a></li>
                            </ul>
                        </div>
                    </div>
    
                </>
            );
        }
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
